    '天同化科': {
        name: '天同化科',
        description: '福星化科，福慧雙修',
        fortune: {
            work: '工作上展現出良好的學習態度和適應能力，容易在輕鬆的環境中獲得成長。',
            love: '感情發展知性而溫馨，適合參與文化活動或學習新事物來增進彼此感情。',
            money: '理財態度平和理性，適合學習穩健的投資方式。今日適合參與理財教育或諮詢。'
        }
    },
    '天同化忌': {
        name: '天同化忌',
        description: '福星化忌，安逸受擾',
        fortune: {
            work: '工作上可能缺乏動力或遇到干擾，建議調整心態，避免過於安逸而錯失機會。',
            love: '感情中可能有懶散或不夠積極的問題，需要更主動地經營關係。',
            money: '理財上可能過於保守或懶於管理，建議更積極地關注財務狀況。'
        }
    },
    '廉貞': {
        name: '廉貞',
        description: '囚星，變化多端',
        fortune: {
            work: '今日工作上可能會有變化或突發狀況，但你的應變能力很強。保持彈性思維，危機也能變轉機。',
            love: '感情上可能有些波折或誤會，但這也是增進了解的機會。保持冷靜溝通，關係會更穩固。',
            money: '財運變化較大，投資需謹慎。避免衝動消費，但可以考慮一些創新的理財方式。'
        }
    },
    '廉貞化祿': {
        name: '廉貞化祿',
        description: '囚星化祿，變中得財',
        fortune: {
            work: '在變化中獲得機會和收益，適合嘗試新的工作方式或項目。變革會為你帶來好處。',
            love: '感情在變化中獲得新的活力，可能有意外的浪漫驚喜或關係的新發展。',
            money: '在變動中獲得財富機會，適合投資新興領域或創新項目。變化帶來財運。'
        }
    },
    '廉貞化忌': {
        name: '廉貞化忌',
        description: '囚星化忌，變化受阻',
        fortune: {
            work: '工作變化帶來困擾，可能有小人干擾或計劃受阻。建議保持低調，穩中求進。',
            love: '感情變化帶來不安，可能有第三者介入或關係不穩定。需要更多溝通和信任。',
            money: '財務變化帶來風險，投資需格外謹慎。避免投機行為，保守理財為佳。'
        }
    },
    '天府': {
        name: '天府',
        description: '庫星，保守穩重',
        fortune: {
            work: '今日適合穩紮穩打，按部就班地完成工作。你的可靠性會得到同事和上司的信任。',
            love: '感情穩定發展，是建立長期關係的好時機。已有伴侶的人可以考慮更進一步的承諾。',
            money: '財運穩健，適合長期投資規劃。今日的理財決策會為未來帶來穩定的收益。'
        }
    },
    '天府化科': {
        name: '天府化科',
        description: '庫星化科，穩重智慧',
        fortune: {
            work: '工作上展現穩重的專業能力，容易獲得上級和同事的信任。適合處理重要的管理工作。',
            love: '以穩重和智慧吸引對方，感情發展穩定而有深度。你的可靠性會讓關係更加牢固。',
            money: '理財知識豐富，投資策略穩健。今日適合學習長期投資理念或制定退休規劃。'
        }
    },
    '太陰': {
        name: '太陰',
        description: '富星，溫和內斂',
        fortune: {
            work: '今日適合幕後工作，你的細心和耐心會發揮很大作用。也是學習新技能或知識的好時機。',
            love: '感情上比較內斂含蓄，但深情款款。今日適合透過溫柔體貼的行動來表達愛意。',
            money: '財運溫和上升，適合穩健的投資方式。女性貴人可能為你帶來財運機會。'
        }
    },
    '太陰化祿': {
        name: '太陰化祿',
        description: '富星化祿，財富豐盈',
        fortune: {
            work: '工作收入穩定增長，可能獲得女性上司或客戶的支持。適合從事與女性相關的業務。',
            love: '感情溫馨甜美，可能收到體貼的關懷或實質的支持。女性魅力特別突出。',
            money: '財運豐盈，特別是透過女性或與女性相關的投資獲得收益。適合穩健的理財方式。'
        }
    },
    '太陰化權': {
        name: '太陰化權',
        description: '富星化權，柔性權威',
        fortune: {
            work: '以溫和但堅定的方式展現領導力，特別在女性同事或客戶中具有影響力。',
            love: '在感情中展現溫柔的主導力，能夠以細膩的方式影響關係的發展方向。',
            money: '財務管理能力增強，特別適合管理家庭財務或進行保守穩健的投資。'
        }
    },
    '太陰化科': {
        name: '太陰化科',
        description: '富星化科，智慧內涵',
        fortune: {
            work: '工作上展現細膩的專業能力和學習態度，容易在需要耐心和細心的領域獲得成功。',
            love: '以內在美和智慧吸引對方，感情發展深刻而持久。適合進行有深度的心靈交流。',
            money: '理財智慧出眾，特別擅長長期投資規劃。今日適合學習價值投資或研究基本面。'
        }
    },
    '太陰化忌': {
        name: '太陰化忌',
        description: '富星化忌，陰霾籠罩',
        fortune: {
            work: '工作上可能有隱憂或不明朗的情況，建議多觀察少行動。避免在不確定的情況下做決定。',
            love: '感情中可能有隱藏的問題或誤會，需要更開放的溝通。避免過度內向或猜疑。',
            money: '財務狀況不明朗，投資需格外謹慎。今日不宜做重大財務決策，多觀察市場動向。'
        }
    },
    '貪狼': {
        name: '貪狼',
        description: '桃花星，多才多藝',
        fortune: {
            work: '今日創意靈感豐富，適合從事創意性工作或學習新技能。你的多元才能會受到重視。',
            love: '桃花運極旺！單身者魅力四射，容易吸引多位追求者。有伴侶的人要小心處理與異性的關係。',
            money: '偏財運不錯，可能有意外收入。但要控制消費慾望，避免為了享樂而花費過多。'
        }
    },
    '貪狼化祿': {
        name: '貪狼化祿',
        description: '桃花星化祿，魅力生財',
        fortune: {
            work: '憑藉個人魅力和才能獲得收入，適合從事銷售、娛樂或創意相關工作。人際關係帶來財運。',
            love: '桃花運和財運並行，可能透過感情獲得實質好處。魅力值爆表，異性緣極佳。',
            money: '偏財運旺盛，可能透過娛樂、投機或人際關係獲得收入。但要注意適度消費。'
        }
    },
    '貪狼化權': {
        name: '貪狼化權',
        description: '桃花星化權，魅力領導',
        fortune: {
            work: '憑藉個人魅力和多元才能在工作中獲得領導地位，特別適合需要人際互動的工作。',
            love: '在感情中展現強大的吸引力和主導權，容易成為被追求的對象。魅力無法擋。',
            money: '投資決策果斷，特別適合投資娛樂、消費相關產業。個人魅力帶來財務機會。'
        }
    },
    '貪狼化忌': {
        name: '貪狼化忌',
        description: '桃花星化忌，慾望受阻',
        fortune: {
            work: '工作上可能因為過度追求享樂而分心，建議專注於本業。避免因為貪心而錯失機會。',
            love: '感情上可能有桃花劫或不當的感情糾葛，需要謹慎處理異性關係。',
            money: '投資時容易被誘惑而做出錯誤決策，特別要避免投機和賭博性投資。'
        }
    },
    '巨門': {
        name: '巨門',
        description: '暗星，口舌是非',
        fortune: {
            work: '今日溝通要格外小心，避免口舌是非。但如果善用口才，也能在談判或演講中表現出色。',
            love: '感情上容易因為溝通不良產生誤會。多聽少說，用心理解對方的想法。',
            money: '財運有陰霾，避免與人發生金錢糾紛。投資決策要多方求證，不要聽信謠言。'
        }
    },
    '巨門化祿': {
        name: '巨門化祿',
        description: '暗星化祿，口才生財',
        fortune: {
            work: '憑藉出色的口才和溝通能力獲得收入，適合從事演講、教學、媒體等相關工作。',
            love: '透過良好的溝通增進感情，言語的力量帶來關係的甜蜜。表達能力受到對方欣賞。',
            money: '透過口才、文字或溝通相關工作獲得收入。適合投資媒體、教育相關產業。'
        }
    },
    '巨門化權': {
        name: '巨門化權',
        description: '暗星化權，話語權威',
        fortune: {
            work: '在溝通和表達方面具有權威性，你的話語具有影響力。適合擔任發言人或意見領袖角色。',
            love: '在感情中善於表達和溝通，能夠引導對話和關係的方向。你的話語很有說服力。',
            money: '在財務溝通和談判中佔有優勢，適合進行商業談判或投資諮詢。'
        }
    },
    '巨門化忌': {
        name: '巨門化忌',
        description: '暗星化忌，口舌招災',
        fortune: {
            work: '工作上容易因為言語不當而招致麻煩，建議謹言慎行。避免參與是非議論。',
            love: '感情中容易因為說話不當而產生誤會或爭執，需要更加謹慎地表達。',
            money: '可能因為口舌是非而損失財富，避免與人發生金錢相關的爭議。投資消息要謹慎求證。'
        }
    },
    '天相': {
        name: '天相',
        description: '印星，服務助人',
        fortune: {
            work: '今日適合擔任協調者角色，你的公正和服務精神會得到大家的認同。也是建立人脈的好時機。',
            love: '在感情中扮演照顧者角色，你的體貼會讓對方很感動。單身者透過幫助他人可能遇到好對象。',
            money: '財運平穩，適合保守理財。今日的善行可能為你帶來意想不到的回報。'
        }
    },
    '天梁': {
        name: '天梁',
        description: '蔭星，長者風範',
        fortune: {
            work: '今日你的經驗和智慧特別受到重視，適合指導後輩或分享專業知識。長輩可能為你帶來機會。',
            love: '在感情中展現成熟穩重的一面，這份安全感會讓關係更加穩固。適合與伴侶進行深度溝通。',
            money: '財運受到貴人庇蔭，長輩或有經驗的人可能給你理財建議。適合學習傳統的理財智慧。'
        }
    },
    '天梁化祿': {
        name: '天梁化祿',
        description: '蔭星化祿，庇蔭得財',
        fortune: {
            work: '得到長輩或貴人的財務支持，工作上的經驗和智慧為你帶來收入。適合從事顧問或指導性工作。',
            love: '感情得到長輩的祝福和支持，可能獲得實質的幫助或禮物。關係穩定且受到庇護。',
            money: '財運受到貴人庇蔭，可能獲得長輩的財務支持或投資建議。傳統投資方式帶來收益。'
        }
    },
    '天梁化權': {
        name: '天梁化權',
        description: '蔭星化權，德高望重',
        fortune: {
            work: '在工作中展現長者風範和權威性，你的經驗和智慧獲得重視。適合擔任指導或管理角色。',
            love: '在感情中展現成熟的領導力，能夠為關係提供穩定的方向和保護。',
            money: '在財務管理方面展現權威和智慧，適合進行長期穩健的投資規劃。'
        }
    },
    '天梁化科': {
        name: '天梁化科',
        description: '蔭星化科，智慧德行',
        fortune: {
            work: '工作上展現出色的專業知識和道德品格，容易獲得尊敬和認可。適合從事教育或諮詢工作。',
            love: '以智慧和品德吸引對方，感情發展穩重而有深度。你的人品會讓關係更加穩固。',
            money: '理財智慧出眾，投資理念穩健。今日適合學習價值投資或研究長期投資策略。'
        }
    },
    '七殺': {
        name: '七殺',
        description: '將星，衝動果決',
        fortune: {
            work: '今日行動力十足，適合處理緊急事務或推動停滯的專案。你的決斷力會帶來突破。',
            love: '在感情上比較直接主動，勇於表達心意。但要注意不要太過衝動，給對方一些空間。',
            money: '投資慾望強烈，但要避免衝動決策。今日的大膽行動如果經過深思熟慮，可能帶來豐厚回報。'
        }
    },
    '破軍': {
        name: '破軍',
        description: '耗星，破舊立新',
        fortune: {
            work: '今日適合突破現狀，推動創新改革。雖然過程可能有阻力，但結果會帶來正面的改變。',
            love: '感情可能面臨變化，但這是成長的機會。單身者可能結束單身，有伴侶的人關係進入新階段。',
            money: '財運變化劇烈，可能有破財也有進財。適合重新檢視理財策略，汰舊換新。'
        }
    },
    '破軍化祿': {
        name: '破軍化祿',
        description: '耗星化祿，破舊得財',
        fortune: {
            work: '在變革和創新中獲得收益，適合推動新項目或改革舊制度。破舊立新帶來財富機會。',
            love: '感情在變化中獲得新的活力和收穫，可能有意外的驚喜或關係的突破性發展。',
            money: '在破舊立新中獲得財富，適合投資新興產業或進行資產重組。變化帶來機會。'
        }
    },
    '破軍化權': {
        name: '破軍化權',
        description: '耗星化權，革新領導',
        fortune: {
            work: '在改革和創新方面展現領導力，能夠推動組織的變革和進步。你的變革能力獲得認可。',
            love: '在感情中展現改變的力量，能夠推動關係朝向新的方向發展。變化中的主導權。',
            money: '在財務變革方面具有決策權，適合進行投資組合的重新配置或開拓新的收入來源。'
        }
}

/**
 * 檢查每日抽卡限制（載入已抽的所有運勢結果）
 */
function checkDailyLimit() {
    const today = new Date().toDateString();
    const lastDrawDate = localStorage.getItem('lastDrawDate');
    
    if (lastDrawDate === today) {
        // 載入今日已抽的所有運勢結果
        loadAllTodayResults();
    } else {
        // 新的一天，清空記錄
        todayDrawnResults = {};
        localStorage.removeItem('lastDrawDate');
        localStorage.removeItem('todayResults');
    }
    
    // 檢查當前選擇的運勢類型狀態
    checkCurrentFortuneLimit();
}

/**
 * 載入今日已抽的所有運勢結果
 */
function loadAllTodayResults() {
    const savedResults = localStorage.getItem('todayResults');
    
    if (savedResults) {
        try {
            todayDrawnResults = JSON.parse(savedResults);
            console.log('載入今日已抽結果:', todayDrawnResults);
        } catch (e) {
            console.error('載入結果失敗:', e);
            todayDrawnResults = {};
        }
    }
}

/**
 * 顯示已存在的抽卡結果
 */
function showExistingResult() {
    const result = todayDrawnResults[currentFortuneType];
    if (result) {
        drawnMainStar = result.mainStar;
        drawnSupportStar = result.supportStar;
        
        showCards();
        setTimeout(() => {
            flipCards();
            setTimeout(() => {
                showResult();
                updateButtonAfterView();
            }, 1000);
        }, 500);
    }
}

/**
 * 查看結果後更新按鈕狀態
 */
function updateButtonAfterView() {
    drawBtn.style.display = 'none';
    
    // 顯示提示信息
    const messageDiv = document.createElement('div');
    messageDiv.className = 'daily-limit-msg';
    messageDiv.style.display = 'block';
    messageDiv.textContent = `今日${getFortuneTypeName(currentFortuneType)}已抽過，可選擇其他運勢類型`;
    
    // 移除舊的提示信息
    const existingMsg = document.querySelector('.daily-limit-msg:not(#limitMsg)');
    if (existingMsg) {
        existingMsg.remove();
    }
    
    // 添加新的提示信息
    drawBtn.parentNode.appendChild(messageDiv);
}

/**
 * 獲取運勢類型中文名稱
 */
function getFortuneTypeName(type) {
    const names = {
        work: '工作運勢',
        love: '感情運勢', 
        money: '財運運勢'
    };
    return names[type] || type;
}

/**
 * 使用日期和運勢類型作為種子的隨機數生成器
 * 確保同一天同一運勢類型的抽卡結果相同
 */
function seededRandom(seed) {
    const x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
}

/**
 * 獲取今日特定運勢類型的種子
 */
function getTodayFortuneSeed(fortuneType) {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;
    const day = today.getDate();
    
    // 不同運勢類型使用不同的種子偏移
    const typeOffset = {
        'work': 100,
        'love': 200,
        'money': 300
    };
    
    return year * 10000 + month * 100 + day + (typeOffset[fortuneType] || 0);
}

/**
 * 抽取主星
 */
function drawMainStar() {
    const starNames = Object.keys(mainStars);
    const seed = getTodayFortuneSeed(currentFortuneType) + 1;
    const randomIndex = Math.floor(seededRandom(seed) * starNames.length);
    return starNames[randomIndex];
}

/**
 * 抽取輔助星
 */
function drawSupportStar() {
    const starNames = Object.keys(supportStars);
    const seed = getTodayFortuneSeed(currentFortuneType) + 2;
    const randomIndex = Math.floor(seededRandom(seed) * starNames.length);
    return starNames[randomIndex];
}

/**
 * 開始抽卡流程
 */
function drawCards() {
    // 檢查當前運勢類型是否已抽過
    if (todayDrawnResults[currentFortuneType]) {
        alert(`今日${getFortuneTypeName(currentFortuneType)}已經抽過了！`);
        return;
    }

    // 抽取星曜
    drawnMainStar = drawMainStar();
    drawnSupportStar = drawSupportStar();

    console.log(`抽中主星: ${drawnMainStar} (${currentFortuneType})`);
    console.log(`抽中輔助星: ${drawnSupportStar} (${currentFortuneType})`);

    // 保存當前運勢類型的結果
    todayDrawnResults[currentFortuneType] = {
        mainStar: drawnMainStar,
        supportStar: drawnSupportStar,
        date: new Date().toDateString()
    };

    // 保存到 localStorage
    const today = new Date().toDateString();
    localStorage.setItem('lastDrawDate', today);
    localStorage.setItem('todayResults', JSON.stringify(todayDrawnResults));

    // 更新按鈕狀態
    drawBtn.textContent = '查看今日運勢';

    // 開始動畫流程
    showCards();
    setTimeout(() => {
        flipCards();
        setTimeout(() => {
            showResult();
            updateButtonAfterView();
        }, 1000);
    }, 500);
}

/**
 * 顯示卡牌
 */
function showCards() {
    cardContainer.style.display = 'flex';
    cardContainer.style.opacity = '0';
    
    // 淡入動畫
    setTimeout(() => {
        cardContainer.style.transition = 'opacity 0.5s ease';
        cardContainer.style.opacity = '1';
    }, 100);
}

/**
 * 翻轉卡牌
 */
function flipCards() {
    // 更新卡牌內容
    document.getElementById('mainStarName').textContent = drawnMainStar;
    document.getElementById('supportStarName').textContent = drawnSupportStar;

    // 翻轉動畫
    setTimeout(() => {
        mainCard.classList.add('flipped');
    }, 200);
    
    setTimeout(() => {
        supportCard.classList.add('flipped');
    }, 600);
}

/**
 * 顯示運勢結果
 */
function showResult() {
    const fortuneTypeNames = {
        work: '工作運勢',
        love: '感情運勢',
        money: '財運運勢'
    };

    // 更新結果內容
    document.getElementById('fortuneTitle').textContent = 
        `今日${fortuneTypeNames[currentFortuneType]}解析`;

    // 主星結果
    const mainStarData = mainStars[drawnMainStar];
    document.getElementById('mainStarHeader').textContent = 
        `${drawnMainStar} - ${mainStarData.description}`;
    document.getElementById('mainStarDesc').textContent = 
        mainStarData.fortune[currentFortuneType];

    // 輔助星結果
    const supportStarData = supportStars[drawnSupportStar];
    document.getElementById('supportStarHeader').textContent = 
        `${drawnSupportStar} (${supportStarData.type})`;
    document.getElementById('supportStarDesc').textContent = 
        supportStarData.effect;

    // 顯示結果區域
    resultSection.classList.add('show');
}

/**
 * 重置選擇（隱藏當前結果，允許選擇其他運勢類型）
 */
function resetSelection() {
    // 隱藏結果區域
    resultSection.classList.remove('show');
    cardContainer.style.display = 'none';
    
    // 重置卡牌狀態
    mainCard.classList.remove('flipped');
    supportCard.classList.remove('flipped');
    
    // 移除額外的提示信息
    const extraMsg = document.querySelector('.daily-limit-msg:not(#limitMsg)');
    if (extraMsg) {
        extraMsg.remove();
    }
    
    // 檢查當前運勢類型的狀態
    checkCurrentFortuneLimit();
}

/**
 * 測試用函數 - 清除今日記錄（開發時使用）
 * 在瀏覽器控制台輸入 clearTodayRecord() 可重置
 */
function clearTodayRecord() {
    localStorage.removeItem('lastDrawDate');
    localStorage.removeItem('todayResults');
    todayDrawnResults = {};
    location.reload();
}

/**
 * 測試用函數 - 清除特定運勢類型的記錄
 */
function clearFortuneType(fortuneType) {
    if (todayDrawnResults[fortuneType]) {
        delete todayDrawnResults[fortuneType];
        localStorage.setItem('todayResults', JSON.stringify(todayDrawnResults));
        
        // 如果清除的是當前選擇的類型，更新UI
        if (currentFortuneType === fortuneType) {
            checkCurrentFortuneLimit();
            resetSelection();
        }
        
        console.log(`已清除 ${fortuneType} 運勢記錄`);
    }
}

// 將測試函數添加到全局作用域（僅開發時使用）
window.clearTodayRecord = clearTodayRecord;
window.clearFortuneType = clearFortuneType;

console.log('紫微斗數抽卡系統載入完成！');
console.log('如需重置今日所有記錄，請在控制台輸入: clearTodayRecord()');
console.log('如需清除特定運勢記錄，請輸入: clearFortuneType("work"), clearFortuneType("love"), 或 clearFortuneType("money")');
;

/**
 * 輔助星資料庫（包含四化）
 * 包含吉星、凶星，以及對主星運勢的修飾說明
 */
const supportStars = {
    // 六吉星
    '左輔': {
        name: '左輔',
        type: '吉星',
        effect: '有貴人相助，左右逢源。今日的運勢會因為他人的幫助而更加順利，團隊合作運極佳。'
    },
    '左輔化科': {
        name: '左輔化科',
        type: '吉星化科',
        effect: '貴人助力增強，且帶來智慧和名聲。今日不僅有人相助，這些貴人還會提供寶貴的知識和經驗。'
    },
    '右弼': {
        name: '右弼',
        type: '吉星',
        effect: '得到助力支持，如虎添翼。身邊的朋友或同事會成為你的得力助手，共同創造佳績。'
    },
    '右弼化科': {
        name: '右弼化科',
        type: '吉星化科',
        effect: '助力帶來智慧和學習機會。今日的貴人不僅提供幫助，還會傳授重要的知識和技能。'
    },
    '天魁': {
        name: '天魁',
        type: '吉星',
        effect: '男性貴人運旺，獲得指導。今日可能遇到對你有幫助的男性長輩或上司，要把握機會。'
    },
    '天鉞': {
        name: '天鉞',
        type: '吉星',
        effect: '女性貴人相助，溫柔力量。今日女性朋友或同事可能為你帶來好運，要懂得感謝。'
    },
    '文昌': {
        name: '文昌',
        type: '吉星',
        effect: '文書運佳，學習順利。今日適合處理文件、學習新知，或是參與文化藝術活動。'
    },
    '文昌化科': {
        name: '文昌化科',
        type: '吉星化科',
        effect: '文書和學習能力大增，容易在考試、文字工作或學術領域獲得成功。智慧和才華受到認可。'
    },
    '文昌化忌': {
        name: '文昌化忌',
        type: '吉星化忌',
        effect: '文書工作可能遇到阻礙，學習上容易分心。今日處理文件要格外仔細，避免出錯。'
    },
    '文曲': {
        name: '文曲',
        type: '吉星',
        effect: '口才便給，溝通無礙。你的表達能力今日特別出色，適合演講、談判或創作。'
    },
    '文曲化科': {
        name: '文曲化科',
        type: '吉星化科',
        effect: '口才和創意能力大增，在溝通、寫作或藝術創作方面特別有天賦。才華橫溢，備受讚賞。'
    },
    '文曲化忌': {
        name: '文曲化忌',
        type: '吉星化忌',
        effect: '溝通容易出現誤會，創作靈感可能受阻。今日說話要謹慎，避免因為表達不當而產生問題。'
    },
    
    // 六煞星
    '擎羊': {
        name: '擎羊',
        type: '凶星',
        effect: '小心衝動行事，容易與人起衝突。今日要控制脾氣，三思而後行，避免意外傷害。'
    },
    '陀羅': {
        name: '陀羅',
        type: '凶星',
        effect: '行事容易拖延，進展緩慢。今日要更加努力才能達成目標，但堅持就會有成果。'
    },
    '火星': {
        name: '火星',
        type: '凶星',
        effect: '情緒容易激動，要避免急躁。雖然行動力增強，但要小心因為太快而出錯。'
    },
    '鈴星': {
        name: '鈴星',
        type: '凶星',
        effect: '暗中有阻礙，進行要小心。今日可能遇到隱藏的困難，但憑藉耐心可以克服。'
    },
    '地空': {
        name: '地空',
        type: '凶星',
        effect: '想法可能不切實際，要腳踏實地。避免好高騖遠，專注於當下能做的事情。'
    },
    '地劫': {
        name: '地劫',
        type: '凶星',
        effect: '可能有破財風險，理財要謹慎。今日避免大額支出或投資，保守為上。'
    },
    
    // 其他重要輔星
    '天馬': {
        name: '天馬',
        type: '動星',
        effect: '行動力強，變動頻繁。今日適合出行、搬遷或是開始新的計劃，把握動能。'
    },
    '祿存': {
        name: '祿存',
        type: '財星',
        effect: '財運亨通，收入穩定。今日的努力會有相應的報酬，是累積財富的好時機。'
    }
};

// ===========================================
// 全局變數定義
// ===========================================

let currentFortuneType = 'work'; // 當前選擇的運勢類型
let todayDrawnResults = {}; // 今日各運勢類型的抽卡結果
let drawnMainStar = null; // 抽中的主星
let drawnSupportStar = null; // 抽中的輔助星

// ===========================================
// DOM 元素引用
// ===========================================

const fortuneButtons = document.querySelectorAll('.fortune-btn');
const drawBtn = document.getElementById('drawBtn');
const limitMsg = document.getElementById('limitMsg');
const cardContainer = document.getElementById('cardContainer');
const mainCard = document.getElementById('mainCard');
const supportCard = document.getElementById('supportCard');
const resultSection = document.getElementById('resultSection');
const resetBtn = document.getElementById('resetBtn');

// ===========================================
// 初始化程序
// ===========================================

/**
 * 頁面載入時執行初始化
 */
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
    bindEvents();
    checkDailyLimit();
});

/**
 * 初始化應用程序
 */
function initializeApp() {
    console.log('紫微斗數抽卡系統初始化...');
    
    // 隱藏卡牌和結果區域
    cardContainer.style.display = 'none';
    resultSection.classList.remove('show');
    
    // 檢查今日是否已抽過卡
    checkDailyLimit();
}

/**
 * 綁定事件監聽器
 */
function bindEvents() {
    // 運勢類型選擇按鈕事件
    fortuneButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            selectFortuneType(this.dataset.type);
        });
    });

    // 抽卡按鈕事件
    drawBtn.addEventListener('click', drawCards);

    // 重置按鈕事件
    resetBtn.addEventListener('click', resetSelection);
}

/**
 * 選擇運勢類型
 * @param {string} type - 運勢類型 (work/love/money)
 */
function selectFortuneType(type) {
    currentFortuneType = type;
    
    // 更新按鈕狀態
    fortuneButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === type) {
            btn.classList.add('active');
        }
    });

    // 檢查當前運勢類型是否已抽過卡
    checkCurrentFortuneLimit();
    
    // 隱藏之前的結果
    cardContainer.style.display = 'none';
    resultSection.classList.remove('show');
    
    // 重置卡牌狀態
    mainCard.classList.remove('flipped');
    supportCard.classList.remove('flipped');

    console.log(`選擇運勢類型: ${type}`);
}

/**
 * 檢查當前運勢類型的抽卡限制
 */
function checkCurrentFortuneLimit() {
    const today = new Date().toDateString();
    const hasDrawnCurrentType = todayDrawnResults[currentFortuneType];
    
    if (hasDrawnCurrentType) {
        // 當前運勢類型已抽過卡
        drawBtn.textContent = '查看今日運勢';
        drawBtn.disabled = false;
        drawBtn.style.display = 'block';
        limitMsg.style.display = 'none';
        
        // 設置查看結果功能
        drawBtn.onclick = function() {
            showExistingResult();
        };
    } else {
        // 當前運勢類型尚未抽卡
        drawBtn.textContent = '開始抽卡';
        drawBtn.disabled = false;
        drawBtn.style.display = 'block';
        limitMsg.style.display = 'none';
        
        // 設置抽卡功能
        drawBtn.onclick = function() {
            drawCards();
        };
    }// ===========================================
// 紫微斗數抽卡運勢系統 - 主程式
// ===========================================

/**
 * 十四主星資料庫（包含四化）
 * 每顆主星包含名稱、特性描述，以及對應三種運勢的詳細說明
 */
const mainStars = {
    '紫微': {
        name: '紫微',
        description: '帝王星，天生領導者',
        fortune: {
            work: '今日工作運勢極佳！你的領導魅力將會發光發熱，適合主導重要專案或會議。同事們會樂意聽從你的建議，是展現管理才能的好時機。',
            love: '感情方面你散發著迷人的魅力，單身者容易遇到條件不錯的對象。有伴侶的人，今天適合規劃未來，或是在關係中扮演主導角色。',
            money: '財運亨通，投資眼光精準。今日適合做重要的財務決策，或是談論薪資待遇。你的判斷力會為你帶來不錯的收益。'
        }
    },
    '紫微化權': {
        name: '紫微化權',
        description: '帝王星化權，權威領導',
        fortune: {
            work: '今日領導權威大增！你的決策能力和執行力都會得到強化，是推動重大變革的絕佳時機。團隊會信服你的領導。',
            love: '在感情中掌握主導權，魅力四射。單身者容易吸引仰慕者，有伴侶的人能夠在關係中建立更強的影響力。',
            money: '財務決策權增強，投資判斷精準。今日適合做重要的投資決定或商業談判，你的權威會為你帶來豐厚收益。'
        }
    },
    '紫微化科': {
        name: '紫微化科',
        description: '帝王星化科，智慧名聲',
        fortune: {
            work: '工作上展現出色的智慧和專業能力，容易獲得上級認可。適合發表意見、參與重要會議，你的聲望會大大提升。',
            love: '以智慧和內涵吸引人，感情發展穩定而有深度。適合進行深度交流，讓對方看到你的內在魅力。',
            money: '理財智慧出眾，投資策略明智。今日的財務規劃會為未來帶來穩定收益，也適合學習新的理財知識。'
        }
    },
    '天機': {
        name: '天機',
        description: '智慧星，足智多謀',
        fortune: {
            work: '今日頭腦特別清晰，適合處理複雜的問題或制定策略。你的智慧和洞察力會幫助團隊找到創新的解決方案。',
            love: '在感情上你很懂得察言觀色，能夠準確掌握對方的心意。單身者透過朋友介紹有機會認識心儀對象。',
            money: '理財方面展現精明的一面，適合研究投資標的或重新配置資產。小心不要過度分析而錯失機會。'
        }
    },
    '天機化祿': {
        name: '天機化祿',
        description: '智慧星化祿，智慧財富',
        fortune: {
            work: '智慧帶來財富機會！你的創意和策略思維會為公司創造價值，也可能獲得額外的收入或獎金。',
            love: '用智慧經營感情，關係和諧美滿。你的體貼和聰明會讓感情生活更加甜蜜，也可能在感情中獲得實質好處。',
            money: '投資理財智慧過人，容易獲得收益。今日的理財決策會帶來實質回報，適合進行中長期投資規劃。'
        }
    },
    '天機化權': {
        name: '天機化權',
        description: '智慧星化權，謀略權威',
        fortune: {
            work: '策略思維獲得重視，在團隊中擔任重要角色。你的建議和計劃會被採納，適合主導企劃或改革項目。',
            love: '在感情中展現智慧的領導力，能夠引導關係朝正向發展。你的建議會被伴侶重視和採納。',
            money: '理財策略獲得成功，投資決策權增強。今日適合制定重要的財務計劃或投資策略。'
        }
    },
    '天機化科': {
        name: '天機化科',
        description: '智慧星化科，聰明才智',
        fortune: {
            work: '工作上展現出色的學習能力和創新思維，容易在專業領域獲得認可。適合參與研發或學術性工作。',
            love: '以才華和智慧吸引對方，感情發展充滿知性美。適合參與文化活動或深度交流。',
            money: '投資研究能力出眾，能夠發現好的投資機會。今日適合學習新的理財知識或投資技巧。'
        }
    },
    '天機化忌': {
        name: '天機化忌',
        description: '智慧星化忌，思慮過度',
        fortune: {
            work: '容易想太多而錯失機會，建議簡化思考過程。雖然分析能力強，但要避免過度猶豫不決。',
            love: '在感情中容易胡思亂想，建議坦誠溝通。不要過度解讀對方的行為，保持簡單直接的交流。',
            money: '投資時容易過度分析而錯失時機。今日建議保守理財，避免過於複雜的投資策略。'
        }
    },
    '太陽': {
        name: '太陽',
        description: '光明星，熱情開朗',
        fortune: {
            work: '今日充滿正能量，你的熱情會感染周圍的人。適合推動新專案、舉辦活動，或是擔任團隊的精神領袖。',
            love: '愛情運勢火熱，你的開朗個性特別吸引人。已有對象的人感情升溫，單身者有機會在社交場合遇到意中人。',
            money: '財運明亮，正財運佳。今日的努力會有相應的回報，也適合與人合作投資或創業。'
        }
    },
    '太陽化祿': {
        name: '太陽化祿',
        description: '光明星化祿，光明財富',
        fortune: {
            work: '工作表現亮眼，容易獲得獎勵或升遷機會。你的努力會得到豐厚回報，也可能獲得意外的收入。',
            love: '感情生活充滿喜悅和甜蜜，可能收到來自伴侶的驚喜或禮物。單身者桃花運旺盛。',
            money: '正財運極佳，收入增加。今日適合談論薪資或尋求新的收入來源，你的努力會有豐厚回報。'
        }
    },
    '太陽化權': {
        name: '太陽化權',
        description: '光明星化權，威權光明',
        fortune: {
            work: '領導魅力大增，在團隊中威信提升。你的影響力會擴大，適合推動重要項目或擔任領導角色。',
            love: '在感情中展現強大的吸引力和影響力，容易成為關係中的主導者。魅力四射，異性緣佳。',
            money: '財務決策果斷有力，投資眼光精準。今日適合做重大的財務決定或商業投資。'
        }
    },
    '太陽化忌': {
        name: '太陽化忌',
        description: '光明星化忌，光芒受阻',
        fortune: {
            work: '工作上可能遇到阻礙或不被重視，建議低調行事。避免過於張揚，專注於實際工作成果。',
            love: '感情中可能有誤會或冷淡期，需要更多耐心和包容。避免過於強勢，給對方一些空間。',
            money: '財運有所阻礙，投資需謹慎。今日不宜做重大財務決策，保守理財為佳。'
        }
    },
    '武曲': {
        name: '武曲',
        description: '財星，務實理財',
        fortune: {
            work: '今日工作效率極高，特別適合處理與數字、金錢相關的業務。你的執行力會讓上司刮目相看。',
            love: '在感情上比較務實，會考慮現實因素。今日適合與伴侶討論未來的實際規劃，如買房、結婚等。',
            money: '今日是你的財運日！適合投資、理財規劃，或是談論加薪。你對金錢的敏銳度會為你帶來收益。'
        }
    },
    '武曲化祿': {
        name: '武曲化祿',
        description: '財星化祿，財源廣進',
        fortune: {
            work: '工作帶來豐厚收入，業績表現出色。今日特別適合談論薪資、獎金或尋求新的收入機會。',
            love: '感情穩定且有實質收穫，可能在感情中獲得物質上的支持或禮物。感情與現實結合得很好。',
            money: '財運極旺！投資收益豐厚，也適合開拓新的財源。今日的理財決策會帶來長期收益。'
        }
    },
    '武曲化權': {
        name: '武曲化權',
        description: '財星化權，財權在握',
        fortune: {
            work: '在財務相關工作中掌握主導權，決策能力受到重視。適合處理重要的財務項目或商業談判。',
            love: '在感情中展現經濟實力和決斷力，能夠為關係提供穩定的物質基礎。',
            money: '財務決策權增強，投資判斷精準。今日適合做重要的投資決定或財務規劃。'
        }
    },
    '武曲化科': {
        name: '武曲化科',
        description: '財星化科，財智雙全',
        fortune: {
            work: '在財務專業領域表現出色，容易獲得專業認可。適合學習新的財務知識或考取相關證照。',
            love: '以穩重和專業能力吸引對方，感情發展穩定。你的可靠性會讓關係更加穩固。',
            money: '理財知識豐富，投資策略明智。今日適合研究新的投資標的或學習理財技巧。'
        }
    },
    '武曲化忌': {
        name: '武曲化忌',
        description: '財星化忌，財務受阻',
        fortune: {
            work: '工作上可能遇到財務相關的困難或阻礙，需要更加謹慎處理金錢事務。',
            love: '感情中可能因為經濟問題產生摩擦，建議理性溝通，避免因金錢問題影響關係。',
            money: '財運有阻礙，投資需格外小心。今日不宜做重大財務決策，保守理財為上策。'
        }
    },
    '天同': {
        name: '天同',
        description: '福星，享受安逸',
        fortune: {
            work: '今日工作氛圍和諧，人際關係融洽。適合團隊合作，你的親和力會讓工作進行得很順利。',
            love: '感情生活甜蜜溫馨，與伴侶相處愉快。單身者有機會透過輕鬆的社交活動認識不錯的對象。',
            money: '財運平穩，適合保守理財。今日不宜冒險投資，但可以享受小小的消費樂趣。'
        }
    },
    '天同化祿': {
        name: '天同化祿',
        description: '福星化祿，享福得財',
        fortune: {
            work: '工作愉快且有收穫，可能獲得意外的獎勵或福利。工作環境和諧，同事關係融洽。',
            love: '感情甜蜜且有實質收穫，可能收到伴侶的貼心禮物或驚喜。愛情帶來快樂和滿足。',
            money: '財運順遂，有意外之財。今日適合輕鬆的理財方式，也可能從興趣或嗜好中獲得收入。'
        }
    },
    '天同化權': {
        name: '天同化權',
        description: '福星化權，和諧領導',
        fortune: {
            work: '以溫和的方式展現領導力，團隊氣氛和諧。你的親和力會讓你在團隊中獲得更多話語權。',
            love: '在感情中展現溫暖的影響力，能夠引導關係朝向更和諧的方向發展。',
            money: '以穩健的方式管理財務，投資決策趨於保守但穩定。適合長期投資規劃。'
        }
    },
    '天同化科': {
        name: '天同化科',
        description: '福星化科，福慧